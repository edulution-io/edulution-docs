# Keycloak 25 auf 26.4 aktualisieren

Diese Anleitung beschreibt das Upgrade von Keycloak 25 auf Version 26.4.

## 1. Container stoppen

```bash
cd /srv/docker/edulution-ui
docker compose down
```

## 2. `docker-compose.yml` anpassen

Ändern Sie das Keycloak-Image und entfernen Sie veraltete Optionen:

```yaml
edu-keycloak:
  image: quay.io/keycloak/keycloak:26.4
  command:
    [
      'start',
      '--proxy-headers=xforwarded',
      '--http-enabled=true',
      '--hostname-strict=false'
    ]
```

**Entfernte veraltete Optionen (in 26.x nicht mehr gültig):**

- `--proxy=edge`

**Entfernte Umgebungsvariablen:**

- `KC_PROXY`
- `KC_HOSTNAME_STRICT_HTTPS`

**Healthcheck anpassen:**

```yaml
    healthcheck:
      test: ["CMD", "bash", "-c", "echo > /dev/tcp/127.0.0.1/9000"]
      interval: 5s
      timeout: 3s
      retries: 5
      start_period: 20s
```

## 3. PostgreSQL-Collation korrigieren

Starten Sie nur die Keycloak-Datenbank:

```bash
docker compose up -d edu-keycloak-db
```

Collation-Version aktualisieren:

```bash
docker exec -it edulution-keycloak-db psql -U keycloak -d keycloak -c "ALTER DATABASE keycloak REFRESH COLLATION VERSION;"
```

Datenbank neu indizieren:

```bash
docker exec -it edulution-keycloak-db psql -U keycloak -d keycloak -c "REINDEX DATABASE keycloak;"
```

## 4. Alle Container starten

```bash
docker compose up -d
```

## 5. Keycloak-Start überprüfen

```bash
docker logs -f edulution-keycloak
```
